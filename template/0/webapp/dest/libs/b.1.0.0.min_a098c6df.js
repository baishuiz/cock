!function(a){function b(a){this.target=a}var c=a.beacon,d=function(c){return this!==a&&d.blend(this,d),new b(c)};d.toString=function(){return"baishuiz@gmail.com"};var e={base:f,avatarCore:b.prototype,self:f,init:function(){var b=Object.freeze;a.beacon=d,e.merge(d,f),delete a.beacon.base,b&&b(d)},login:function(){a.beacon=d},logoff:function(){a.beacon=c}},f={base:e};a.beacon=f}(this),function(a){var b=beacon.base||{},c={merge:function(a){for(var b=arguments.length,c=1;c<b;c++){var d=arguments[c];for(var e in d)a[e]!==d[e]&&(a[e]=d[e])}return a},blend:function(a,b,d){var e={cover:!0,mergePrototype:!1,reset:!1};if(d=d?c.merge(e,d):e,b=[].concat(b),d.reset)for(var f in a)b[0][f]||(b[0][f]=void 0);for(var g=b.length,h=0;h<g;h++){var i=b[h];for(var j in i){var k=d.mergePrototype||i.hasOwnProperty(j),l=d.cover||!a[j];k&&l&&(a[j]=i[j])}}return a},isType:function(a,b){return"Null"===b&&null===a||"Undefined"===b&&void 0===a||"Number"===b&&isFinite(a)||Object.prototype.toString.call(a).slice(8,-1)===b},arrayIndexOf:function(a,b){return c.arrayIndexOf=Array.prototype.indexOf?function(a,b){return(a=[].slice.call(a,0)).indexOf(b)}:function(a,b){for(var c=(a=[].slice.call(a,0)).length;0<=c;c--)if(a[c]===b)return c;return c},c.arrayIndexOf(a,b)},each:function(a,b){if(a){a=[].concat(a);for(var c=0;c<a.length;c++)b.call(a[c],c,a[c])}}};c.blend(b,c)}(),function(a){var b=beacon.base;b.EventStructure=function(a){function c(a){var b=d(e,a);b<0&&(b=e.push(a)-1);var c="event_"+b;return a.toString()===a?a:c}var d=b.arrayIndexOf,e=[];return{dom:a,target:a,attachEvent:function(a,b){var d=c(a);e[d]=e[d]||[],e[d].push(b)},removeEvent:function(a,b){var d,f=a&&c(a),g=f&&e[f];if(a&&b)for(var h=g.length-1;0<=h;h--)g[h]===b&&(d=e[f].splice(h,1));else a&&!b?(d=e[f],e[f]=[]):a||b||(d=e,e=[]);return d},getEventList:function(a){var b;if(!a)return e.slice(0);var f,g=d(e,f=a)<0?null:c(f);return g&&(b=a?e[g]:e.slice(0)),b}}}}(),function(a){function b(a,b,c){var f;(d(a)||(f=new g(a),e.push(f),f)).attachEvent(b,c)}function c(a,b,c){var g=e.slice(0),h=a?d(a)||[]:e.slice(0);f.each(h,function(a,d){d.removeEvent(b,c),(!b&&!c||0==d.getEventList().length)&&(a=f.arrayIndexOf(e,d),g.splice(a,1))}),e=g}function d(a){if(!a)return e.slice(0);for(var b=0;b<e.length;b++){var c=e[b];if(c.target===a)return c}}var e=[],f=a.base,g=f.EventStructure,h={registEvent:b,registCombinationEvent:function(a,c,d){var e=c.registEvent(d),g=c.getEventList();f.each(g,function(c){b(a,g[c],e)})},removeEvent:c,removeCombinationEvent:function(a,b,d){var e=b.removeEvent(d);f.each(e,function(d){var g=e[d],h=b.getEventList();f.each(h,function(b,d){c(a,d,g)})})},getEventList:d};f.eventStore=h}(beacon),function(a){var b=beacon.base;b.combinationalEvent=function a(){if(this instanceof a)return this;var c=[],d=[],e=[].slice.call(arguments,0),f=(e.slice(0),function(){function a(){return e.slice(0)}this.resetEventList=a,this.getEventList=function(){return e.slice(0)},this.registEvent=function(f){var g,h,i=b.arrayIndexOf,j=e.slice(0),k=function(b,c){var d=i(j,b.eventType);0<=d&&j.splice(d,1),0===j.length&&(f.call(this,c),j=a())};return g=f,h=k,b.arrayIndexOf(c,g)<0&&(c.push(g),d.push(h)),k},this.removeEvent=function(a){var e,f,g;return[].concat((e=a,f=b.arrayIndexOf(c,e),g=d[f],e?g:d.slice(0)))}});return f.prototype=new a,new f}}(),function(a){var b,c=beacon.base,d=c.eventStore,e=d.registCombinationEvent,f=d.registEvent,g=d.removeCombinationEvent,h=d.removeEvent,i=d.getEventList,j={hostProxy:{},attachActionEvent:function(a,b,d){var e=a.desc,f=c.isType(a.desc,"Function");f&&e(b,d),c.each(["touchmove","mousemove"],function(b,c){f&&window.beacon(document).on(c,function(b){j.publicDispatchEvent(a,b)})})},attachEvent:function(a,b){var d=a instanceof c.combinationalEvent?e:f;j.attachActionEvent(a,this,b),d(this,a,b)},fireEvent:function(a,b){var d=this,e=i(d);if(e){var f=e.getEventList(a),g=c.isType(a.desc,"Function");!(!g||!a.desc(b))==!!g&&c.each(f,function(c,e){var f={eventType:a};e.call(d,f,b)})}},publicDispatchEvent:function(a,b){var d=i();c.isType(a.desc,"Function")&&a.desc(b),c.each(d,function(c){var e=d[c].dom;j.fireEvent.call(e,a,b)})},removeEvent:function(a,b){(a instanceof c.combinationalEvent?g:h)(this,a,b)}},k=((b=function(){}).prototype=j,c.blend(b,j),b);c.Event=k}(),function(a){var b=beacon.base,c=function(){return this}(),d=b.EventStructure,e={structures:[],getStructure:function(a){for(var b,c,d=0;d<e.structures.length;d++){b=e.structures[d];try{c=b.dom===a}catch(d){b.dom=window.document,c=b.dom===a}if(c)return b}},add:function(a,b,c){var f=e.getStructure(a);f||(f=new d(a),e.structures.push(f)),f.attachEvent(b,c)},remove:function(a,b,c){var d=e.getStructure(a);return d&&d.removeEvent(b,c)}},f={attachEvent:function(a,b){var d,e=function(a,b){this.addEventListener(a,b,!1)},g=function(a,b){this.attachEvent("on"+a,b)},h=function(a,b){var c=this,d=c["on"+a];c["on"+a]=function(){d.call(c),b.call(c)}};return c.addEventListener?(e.call(this,a,b),d=e):c.attachEvent?(g.call(this,a,b),d=g):(h.call(this,a,b),d=h),f.attachEvent=d},fireEvent:function(a,b){var c,d=function(a,b){(b=b||{bubbles:!0,cancelable:!0}).ieHack=this.all&&this.all.toString(),b.ieHack=this.style;var c=document.createEvent("Event");c.initEvent(a,b.bubbles,b.cancelable),b.state&&(c.state=b.state),this.dispatchEvent(c)},e=function(a,b){(b=b||{bubbles:!0,cancelable:!0}).ieHack=this.all&&this.all.toString(),b.ieHack=this.style,a="on"+a;var c=document.createEventObject();c.cancelBubble=b.cancelable,this.fireEvent(a,c)};return document.createEvent&&this.dispatchEvent?(d.call(this,a,b),c=d):document.createEventObject&&this.fireEvent&&(e.call(this,a,b),c=e),c},removeEvent:function(a,b){var c,d=function(a,b){this.removeEventListener(a,b,!1)},e=function(a,b){this.detachEvent("on"+a,b)};return this.removeEventListener?(d.call(this,a,b),c=d):this.detachEvent&&(e.call(this,a,b),c=e),f.removeEvent=c}},g={attachEvent:function(a,b){e.add(this,a,b),f.attachEvent.call(this,a,b)},fireEvent:function(a,b){g.fireEVent=f.fireEvent.call(this,a,b)},removeEvent:function(a,c){var d=this;if(a&&c)f.removeEvent.call(d,a,c);else if(a&&!c){var h=e.remove(d,a);h&&b.each(h,function(){g.removeEvent.call(d,a,this)})}else if(!a&&!c){var i=e.remove(d);i&&b.each(i,function(){var a=this;a&&b.each(i[a],function(){g.removeEvent.call(d,a,this)})})}},isHTMLElement:function(a){var b;return a==document||a==window||(b=a)&&b.nodeName&&b.nodeType},isEventSupported:function(a,c){if(!g.isHTMLElement(a)||!b.isType(c,"String"))return!1;var d=!1;if(a===window||a===document){d="on"+c in a;var e=!!window.ActiveXObject&&!!document.documentMode;if(!d&&e)return!1;if(d)return!0;var f=document.createElement("iframe");f.style.display="none",document.body.appendChild(f);var h=a===window?f.contentWindow:f.contentDocument;g.attachEvent.call(h,c,function(){d=!0}),g.fireEvent.call(h,c),f.parentNode.removeChild(f)}else{var i=a.tagName;c="on"+c,a=document.createElement(i),(d=c in a)||(a.setAttribute(c,"return;"),d="function"==typeof a[c]),a=null}return d}};b.DOMEvent=g}(),function(a){var b,c,d,e,f,g,h,i=a.base,j={on:(d=a.base,e=d.isType,f=d.Event.hostProxy,g=d.Event.publicDispatchEvent,h=d.Event.attachEvent,function(a,b){var c=[].slice.call(arguments,0);b&&e(b,"Function")?h.apply(f,c):g.apply(f,c)}),once:function(a,b){var c=function(d,e){j.off(a,c),b.call({},d,e)};j.on(a,c)},off:(b=a.base,c=b.Event.hostProxy,function(){var a=[].slice.call(arguments,0);b.Event.removeEvent.apply(c,a)}),blend:i.blend,NS:i.NS,arrayIndexOf:i.ArrayIndexOf,isType:i.isType,Enum:i.Enum,loginGlobal:i.login,logoffGlobal:i.logoff,utility:i,createEvent:function(){var a=[].slice.call(arguments,0);return 1<arguments.length?i.combinationalEvent.apply(this,a):{desc:a[0]}}},k={on:function(b,c){var d=[].slice.call(arguments,0),e=this.target,f=a.base,g=f.DOMEvent.isHTMLElement(e),h=f.DOMEvent.isEventSupported(e,b),i=g&&h?f.DOMEvent.fireEvent:f.Event.fireEvent,j=g&&h?f.DOMEvent.attachEvent:f.Event.attachEvent;c&&f.isType(c,"Function")?f.each(e,function(a,b){j.apply(b,d)}):f.each(e,function(a,b){i.apply(b,d)})},once:function(a,b){var c=this,d=function(e,f){k.off.call(c,a,d),b.call(c,e,f)};k.on.call(c,a,d)},off:function(a,b,c){var d=this.target,e=i.DOMEvent.isHTMLElement(d),f=a&&i.DOMEvent.isEventSupported(d,a);e&&f?i.DOMEvent.removeEvent:i.Event.removeEvent,i.each(d,function(d,f){var g=a&&i.DOMEvent.isEventSupported(f,a);e&&i.DOMEvent.removeEvent.call(f,a,b,c),g||i.Event.removeEvent.call(f,a,b,c)})}};i.blend(i.avatarCore,k),i.blend(a,j),i.init()}(beacon),function(a){function b(a){this.target=a}var c=function(a){return new b(a)};c.toString=function(){return"baishuiz@gmail.com"};var d=document.getElementsByTagName("script"),e=d[d.length-1],f={avatarCore:b.prototype,plugins:{},attach:function(a,b){f.plugins[a]=b},baseURL:e.src.replace(/\/[^\/]+$/,"/"),URLMap:{},CDNTimestamp:e.getAttribute("data-CDNTimestamp")||"",isDebug:!1,init:function(b){a.Air=f.plugins.merge(c,b)}},g={base:f};a.Air=g}(this),function(a){var b={NS:function(a,b){for(var c=a.split("."),d=b||window||{},e=(b=d,0),f=c.length;e<f;e++)d[c[e]]=void 0===d[c[e]]?{}:d[c[e]],d=d[c[e]];return d},beacon:beacon,merge:beacon.utility.merge,setBaseURL:function(b){return beacon.isType(b,"Object")?(a.base.URLMap=b,a.base.baseURL=b.base||a.base.baseURL):a.base.baseURL=b||a.base.baseURL}};b.merge(a.base.plugins,b)}(Air),function(a){var b=!1,c=[],d=a.base.plugins.beacon,e=(a.base.plugins,function(){d(document).off("readystatechange",f),d(document).off("DOMContentLoaded",e),d(window).off("load",e);for(var a;a=c.shift();)b||a();b=!0}),f=function(){(/loaded|complete/.test(document.readyState)||1==b)&&e()};d(document).on("readystatechange",f),d(document).on("DOMContentLoaded",e),d(window).on("load",e),document.documentElement.doScroll&&function a(){try{document.documentElement.doScroll("left")}catch(b){return void setTimeout(a,1)}e()}(),a.base.attach("DOMReady",function(a){return 1==b?void a():void c.push(a)})}(Air),function(a,b){function c(a,b){var c=1;this.loadJS=function(){if(/\bArray\b/.test(Object.prototype.toString.call(a)))for(var d=(c=a.length)-1;0<=d;d--)e(a[d],function(){--c||b()});else e(a,b)}}function d(){function a(){b.currentJs||(b.currentJs=b.shift(),b.currentJs&&b.currentJs.loadJS())}var b=[];b.currentJs=null,this.loadJS=function(d,e){return b.push(new c(d,function(){b.currentJs=null,e&&e(),a()})),a(),this}}function e(a,c){var d,e=document.getElementsByTagName("head")[0],f=document.createElement("script"),g=!1,h=b.base.plugins.beacon,i=function(){g=!0,h(f).off("load"),h(f).off("readystatechange"),i=function(){},c&&c()};f.async=!0,f.setAttribute("type","text/javascript"),f.src=a,h(f).on("load",i),h(f).on("readystatechange",function(){/loaded|complete/.test(f.readyState)&&0==g&&i()}),h(f).on("error",i);for(var j=document.getElementsByTagName("script"),k=0,l=j.length;!d&&k<l;k++)d=a==j[k].getAttribute("src");d||e.appendChild(f)}b.base.attach("loadJS",function(a,b){var c=new d;return c.loadJS(a,b),c})}(0,Air),function(a){var b={};a.base.Module=function(c,d){"use strict";function e(){var e=h.toLowerCase(),f=g.toLowerCase(),i=a.base,j=i.plugins.beacon,k=i.plugins.NS,l=i.plugins.NS(g.toLowerCase(),i)[e],m=d(i.Require,i.run);l?"function"==typeof m?k(f,i)[e]=i.plugins.merge(m,l):i.plugins.merge(l,m):k(f,i)[e]=m,b[c.toLowerCase()]=!0,j.on(a.base.Require.Event.LOADED,{moduleName:c})}a.base.plugins.beacon.on(a.base.Require.Event.REQUIREING,{moduleName:c});var f=c.match(/(^.*)\.(\w*)$/),g=f[1],h=f[2],i=d.toString().replace(/(?!['"])\/\*[\w\W]*?\*\//gim,""),j=(i=i.replace(/(['"\/])[\w\W]*?\1|((['"\/])[\w\W]*?)\/\/[\w\W]*?\2|\/\/[\w\W]*?(\r|\n|$)/g,function(a,b){return b?a:""})).replace(/^function\s*?\(\s*?([^,\)]+)[\w\W]*$/,function(a,b){return b}).replace(i,""),k=j&&new RegExp("\\b"+j+"\\s*\\(([^\\)]+)\\)","gm"),l=[];k&&i.replace(k,function(c,d){var e,f,g=/['" ]/g,h=d.split(",");1<h.length?(e=h[0].replace(g,""),f=h[1].replace(g,"")):e=d.replace(g,"");var i=e.toLowerCase();b[i]||(l[i]=l.push(i)-1),a.base.Require(e,f)});var m=new String(c);l.length&&beacon(m).on(a.base.Require.Event.LOADED,function(b,c){var d=c.moduleName.toLowerCase();l.hasOwnProperty(d)&&(delete l[d],l.splice(l[d],1)),l.length<=0&&(beacon(m).off(a.base.Require.Event.LOADED),e())}),l.length||e()}}(Air),function(a){function b(a){if(a)return g.moduleLoaded[a];for(var b=0,c=g.requireQueue.length;b<c;b++){var d=g.requireQueue[b];if(!g.moduleLoaded[d])return!1}return!0}function c(){d.on(f.COMPLETE),d(document).on("readystatechange"),c=function(){d.on(f.COMPLETE)}}var d=a.base.plugins.beacon,e=d.createEvent,f={COMPLETE:e("require_complete"),LOADED:e("require_loaded"),REQUIREING:e("require_requireing")},g={requiring:{},required:{},moduleLoaded:{},requireQueue:[]};d(g).on(f.REQUIREING,function(a,b){var c=b.moduleName.toLowerCase();g.requireQueue[c]||g.requireQueue.push(c),g.required[c]=!0});var h=function(d,e){var f,h,i,j,k,l=d;if(d=d.toLowerCase(),g.required[d]||g.requiring[d]||g.moduleLoaded[d])return a.base.plugins.NS(d,a.base);if(e){var m=a.base.URLMap||{};e=e.replace(/{{(.+)}}/g,function(b,c){return m[c]||a.base.baseURL})}return e=e||((j=(i=l).match(/(^.*)(\.\w*)$/))[1],j[2],k=(k=a.base.CDNTimestamp||"")&&"?"+k,a.base.baseURL+i.replace(/\./gi,"/")+".js"+k),d=d.toLowerCase(),g.requireQueue[d]=!0,g.requireQueue.push(d),h=f=d,g.required[h]||g.requiring[h]||g.moduleLoaded[h]||(g.requiring[f]=!0,a.base.plugins.loadJS(e,function(){if(!g.required[f])throw new Error("module ["+f+"] is undefined! @"+e);b()&&c()})),a.base.plugins.NS(d,a.base)};d.on(f.LOADED,function(a,d){var e=d.moduleName.toLowerCase();g.required[e]=!0,g.moduleLoaded[e]=!0,b()&&c()}),h.Event=f,h.isRequireComplete=b,a.base.Require=h}(Air),function(a){function b(){for(;a=void 0,(a=c.shift())&&a(),c.length;);var a}var c=[],d=a.base.plugins.beacon,e=a.base.Require.Event;d.on(e.COMPLETE,b);var f=function(g,h){"use strict";if(!(this instanceof f))return new f(g,h,arguments);var i=[].slice.call(arguments[2]).slice(2),j=this;j.runNow=h,function(){function f(){for(var b=0;b<h.length;b++){var c=h[b];if(!h[c]&&!a.base.Require.isRequireComplete(c))return!1}return!0}var g,h=[];this.runNow&&d.on(e.LOADED,function(a,b){var c=b.moduleName.toLowerCase();h[c]=!0,0<=beacon.utility.arrayIndexOf(h,c)&&f()&&g&&g()}),this.run=function(d){g=d,this.runNow?f()&&d():(c.push(d),a.base.Require.isRequireComplete()&&b())},this.require=function(b,c){if(a.base.Require(b,c),b=b.toLowerCase(),h.push(b),!c){var d=b.match(/(^.*)\.(\w*)$/),e=d[1],f=d[2];a.base.plugins.NS(e,a.base)[f]}return a.base.plugins.NS(b,a.base)}}.call(j);var k=g.toString().replace(/(?!['"])\/\*[\w\W]*?\*\//gim,""),l=(k=k.replace(/(['"\/])[\w\W]*?\1|((['"\/])[\w\W]*?)\/\/[\w\W]*?\2|\/\/[\w\W]*?(\r|\n|$)/g,function(a,b){return b?a:""})).replace(/^function\s*?\(\s*?([^,\)]+)[\w\W]*$/,function(a,b){return b}).replace(k,""),m=l&&new RegExp("\\b"+l+"\\s*\\(([^\\)]+)\\)","gm");m&&k.replace(m,function(a,b){var c,d,e=/['" ]/g,f=b.split(",");1<f.length?(c=f[0].replace(e,""),d=f[1].replace(e,"")):c=b.replace(e,""),j.require(c,d)}),j.run(function(){var a=[j.require].concat(i);g.apply(this,a)})};a.base.attach("run",f)}(Air),function(a){var b=a.base.plugins,c={run:b.run,iRun:function(a){b.run(a,!0)},loadJS:b.loadJS,Module:a.base.Module,merge:a.base.merge,NS:b.NS,Enum:a.base.Enum,domReady:b.DOMReady,moduleURL:b.setBaseURL,setCDNTimestamp:a.base.setCDNTimestamp};a.base.init(c)}(Air),Air.Module("B.util.middleware",function(){var a={};return{add:function(b,c){b&&c&&(a[b]=a[b]||[],a[b].push(c))},run:function(b,c,d){var e=a[b],f=e&&e.length;if(d=d||function(){},f){var g=0,h=function(){var a=e[g];g<f&&a?a(c,function(){g++,h.apply(h,arguments)}):d.apply(d,arguments)};h()}else d()},remove:function(b,c){if(b&&c){var d=a[b]||[],e=d.indexOf(c);-1!==e&&d.splice(e,1)}}}}),Air.Module("B.util.node",function(){var a=function(a){return{hasAttribute:function(b){return a.attributes.getNamedItem(b)}}};return a.type={TEXT:3,HTML:1,ATTR:2},a}),Air.Module("B.util.util",function(require){var a=require("B.util.node");return function(){function b(){}return b.isEmpty=function(a){if(null==a)return!0;var b=beacon.utility.isType(a,"Object"),c=beacon.utility.isType(a,"Array");if(!b&&!c)return!1;for(var d in a)if(a.hasOwnProperty(d))return!1;return!0},b.enums=function(a){for(var b={},c=a.length-1;0<=c;c--)b[a[c]]=a[c];return b},b.getData=function(a,c){for(var d=c.parent,e=a.split("."),f=c||window||{},g=(c=f,0),h=e.length;g<h;g++){if(!f||void 0===f[e[g]])return d&&b.getData(a,d);f=f[e[g]]}return f},b.trim=function(a){return(a=a||"").trim?a.trim():a.replace(/^\s+|\s+^/,"")},b.isHTML=function(b){return!!b&&b.nodeType===a.type.HTML},b}()}),Air.Module("B.data.memCache",function(){var a={},b={};return{get:function(c){if(c){var d=a[c],e=b[c];return e&&(new Date).getTime()>e.getTime()?(delete a[c],void delete b[c]):d}},set:function(c,d,e){if(c&&(a[c]=d,e&&"number"==typeof e.expiredSecond)){var f=new Date;f.setSeconds(f.getSeconds()+e.expiredSecond),b[c]=f}}}}),Air.Module("B.data.storage",function(require){var a=require("B.data.memCache");return{get:function(b,c){var d=a.get(b);return c&&c(d),d},set:a.set}}),Air.Module("B.event.events",function(){return{DATA_CHANGE:beacon.createEvent("data change"),RUN_COMPLETE:beacon.createEvent("run complete"),URL_CHANGE:beacon.createEvent("url change"),USER_ACTION:beacon.createEvent("user action"),PAGE_SHOW:beacon.createEvent("page show"),PAGE_HIDE:beacon.createEvent("page hide"),PAGE404:beacon.createEvent("")}}),Air.Module("B.directive.event",function(require){var node=require("B.util.node"),EVENTS=require("B.event.events"),attribute="b-event",reg=/\((.*)\)/,api=function(target,$scope){function getParentScope(a){return a}function bind(cmd,eventIndex){var eventName=cmd.match(/^\s*(\w+)\s+/)[1];beacon(target).on(eventName,function(e){var cmd=target.getAttribute(attribute),cmdList=cmd.split(";"),handleStr=cmdList[eventIndex].replace(eventName,""),eventHandleName=handleStr.replace(reg,"").replace(/\s/g,""),eventParam=handleStr.match(reg)[1],params=eval("["+eventParam+"]");params.unshift(e),this.$index=$scope.$index;var scope=getParentScope($scope),eventHandle=$scope.$event&&$scope.$event[eventHandleName]||scope.$event&&scope.$event[eventHandleName];eventHandle&&eventHandle.apply(this,params),beacon(scope).on(EVENTS.DATA_CHANGE,scope)})}if(node(target).hasAttribute(attribute))for(var cmd=target.getAttribute(attribute),cmdList=cmd.split(";"),i=0;i<cmdList.length;i++)bind(cmdList[i],i)};return api}),Air.Module("B.directive.show",function(require){function a(a,b,c){return a.bData=a.bData||{},a.bData[b]=c}function b(a){var b,c,d,e=document.body.appendChild(document.createElement(a)),f=(c="display",(d=(b=e).style.display)||(d=window.getComputedStyle?window.getComputedStyle(b,null)[c]:b.currentStyle[c]),d);return document.body.removeChild(e),f}function c(c,d){var e,f,h,i,j,k;c&&c.style&&(i="olddisplay",(h=c).bData=h.bData||{},f=h.bData[i],e=c.style.display,d?(f||"none"!==e||(e=c.style.display=""),""===e&&(f=a(c,"olddisplay",(j=c.nodeName,(k=g[j])||(k=b(j),g[j]=k),k)))):e&&"none"!==e&&a(c,"olddisplay",e),d&&"none"!==e&&""!==e||(c.style.display=d?f||"":"none"))}var d=require("B.util.node"),e=(require("B.event.events"),require("B.util.util"),"b-show"),f=function(a,b,f){d(a).hasAttribute(e)&&function(a,b,d){b.scope;var f=b.name,g=a.getAttributeNode(e);g.nodeValue="{{("+g.nodeValue+")}}",d(g.nodeValue,g,f,function(b){b?c(a,!0):c(a)},!0)}(a,b,f)};f.key=e;var g={};return f}),Air.Module("B.directive.exist",function(require){var a=require("B.util.node"),b=(require("B.event.events"),require("B.util.util"),"b-exist"),c=function(c,d,e){a(c).hasAttribute(b)&&function(a,c,d){c.scope;var e=c.name,f=a.getAttributeNode(b);f.nodeValue&&(f.nodeValue="{{("+f.nodeValue+")}}",d(f.nodeValue,f,e,function(b){b&&function(a){if(a){var b=a.parentElement;b&&b.removeChild(a)}}(a)},!0))}(c,d,e)};return c.key=b,c}),Air.Module("B.directive.style",function(require){var a=require("B.util.node"),b=(require("B.event.events"),require("B.util.util"),"b-style");return function(c,d,e){a(c).hasAttribute(b)&&function(a,c,d){function e(b){a.style.cssText=b}c.scope;for(var f=c.name,g=a.getAttributeNode(b),h=g.nodeValue.match(/{{.*?}}/g)||[],i=0;i<h.length;i++){d(h[i],g,f,e)}}(c,d,e)}}),Air.Module("B.directive.property",function(require){var a=require("B.util.node"),b=(require("B.event.events"),require("B.util.util")),c="b-property";return function(d,e,f){a(d).hasAttribute(c)&&function(a,d,e){for(var f=d.scope,g=d.name,h=a.getAttributeNode(c),i=function(a){var b=[];return a.replace(/(\w+)\s*:\s*([^,}\s]+)/g,function(a,c,d){var e={name:c,dataPath:d};b.push(e)}),b}(a.getAttribute(c)),j=0;j<i.length;j++){var k=i[j];!function(c,d){var i=b.getData(c,f);void 0!==i&&(a[d]=i),e("{{"+c+"}}",h,g,function(){var e=b.getData(c,f);a[d]=e})}(k.dataPath,k.name)}}(d,e,f)}}),Air.Module("B.directive.model",function(require){var a=require("B.util.node"),c=require("B.util.util"),d=(require("B.event.events"),"b-model"),e=function(e,f,g){function h(a){var d,e=this;if("checkbox"===e.type){var f=e.getAttribute("b-model");if(d=c.getData(f,j),beacon.utility.isType(d,"Array")){var g=beacon.utility.arrayIndexOf(d,e.value);e.checked?d.push(e.value):0<=g&&d.splice(g,1),e.nodeName.toLowerCase(),e.getAttribute("name"),b.views.getActive().getDom()}else d=e.checked}else d=e.value;i=d,k=j,l=m.split("."),n=l.pop(),(o=l.join("."))?c.getData(o,k)[n]=i:k[n]=i;var i,k,l,n,o,p="input"===a.type?"change":"input";beacon(e).off(p,h)}function i(){var a=c.getData(m,j);if(e.value!==a||"radio"===e.type){var d=c.isEmpty(a)?"":a;beacon.utility.isType(a,"Array")?function(a,b,c,d){for(var e=(d=d||document).querySelectorAll(c),f=0;f<e.length;f++){var g=e[f];0<=beacon.utility.arrayIndexOf(a,g.value)?g.checked=!0:g.checked=!1}}(d,0,e.nodeName.toLowerCase()+"[name="+e.getAttribute("name")+"]",b.views.getActive().getDom()):e.value===a&&"radio"!=e.type||(e.initValue=d,"file"!==e.type&&("radio"==e.type?e.checked=e.value==d:(e.checked=d,e.value=d)))}else e.initValue=a}var j=f.scope,k=f.name;if(a(e).hasAttribute(d)){var l=e.getAttributeNode(d),m=e.getAttribute(d).replace(/{{|}}/gi,"");void 0!==c.getData(m,j)&&i(),beacon(e).on("input",h),beacon(e).on("change",h),g("{{"+m+"}}",l,k,i)}};return e.key=d,e}),Air.Module("B.scope.Scope",function(require){require("B.event.events"),require("B.util.util");var a=function(a){this.parent=a};return function(b){return a.prototype=b||{},new(a.prototype.constructor=a)(b)}}),Air.Module("B.scope.ScopeTreeManager",function(require){var a=require("B.scope.Scope");return function(){function b(a){void 0===a&&(a={}),this.scopeMap={};var c=b.getStructure();c.scope=a,this.rootScope=c}return b.getStructure=function(){return{scope:null,pn:null,name:null}},b.prototype.getScope=function(a){return this.getScopeByName(a)},b.prototype.getRoot=function(){return this.rootScope},b.prototype.setRootScope=function(a){this.rootScope.scope=a},b.prototype.addScope=function(c,d){var e=this.getScope(c)||this.rootScope,f=b.getStructure();return(this.scopeMap[d]=f).scope=new a(e.scope),f.pn=c,f.name=d},b.prototype.getScopeByName=function(a){return this.scopeMap[a]},b.prototype.getScopeInstanceByName=function(a){return(this.getScope(a)||{}).scope},b}()}),Air.Module("B.directive.Repeater",function(require){function a(a,b,c,d){var e=new RegExp("\\b("+d+")\\b","g"),f=new RegExp("\\b"+c+"\\.\\d+\\.\\$index\\b","g"),g=new RegExp("{{\\b"+c+"\\.\\d+\\.\\$index\\b}}","g"),h=a.replace(/\{\{.*?\}\}|b-show\s*=\s*"[^"]*?"|b-exist\s*=\s*"[^"]*?"|b-model\s*=\s*"[^"]*?"|b-property\s*=\s*"[^"]*"|b-repeat\s*=\s*"[^"]*"/g,function(a){return a.replace(e,c+"."+b)});return h=(h=h.replace(g,b)).replace(f,b)}var b,c=require("B.util.util");return Array.prototype.unshift=(b=Array.prototype.unshift,function(a){var c=JSON.stringify(this[this.length-1]);return this[this.lenght]={},b.call(this,a),c&&(this[this.length-1]=JSON.parse(c)),this.length}),function(b,d,e,f){function g(a,b,d){for(var e="",f=b.split(".")||[],j=0;j<f.length;j++){var k=f[j],l=e?c.getData(e,i):i;l=l||Air.NS(e,i);var m=k&&c.getData(k,l),n=Object.getOwnPropertyDescriptor(l,k);n&&n.get&&t.indexOf(n)<0&&t.push(n),d&&beacon(i).on("updateRepeatData"+f.slice(0,j+1).join(""),function(a,b){g(u,b.dataPath),b.callback&&b.callback()});var o=h.call(l,a,m,f.slice(0,j+1).join("."));"object"==typeof l&&(j===f.length-1||!n||!n.get)&&Object.defineProperty(l,k,o),e=k&&e?e+"."+k:k}}function h(a,b,c){var e=0;b=b||[];var h={enumerable:!0,configurable:!0,get:function(){return setTimeout(function(){var c=b&&b.length||0;if(e!==c){for(var g=a.updateUI(),h=0;h<g.length;h++){var i=g[h];i&&f(i,d,d)}for(h=0;h<t.length;h++)t[h]&&t[h].get&&t[h].get()}e=c},0),b},set:function(i,j){var k=b!==i;i||(i=beacon.utility.isType(b,"Array")?[]:{});var l,m=beacon.utility.isType(i,"Array"),n=beacon.utility.isType(i,"Object");if(k)if(n){for(var o in b=b||{})i[o]||(i[o]=void 0);for(var o in b){var p=Object.getOwnPropertyDescriptor(b,o);p&&p.get||(beacon.utility.isType(b[o],"Array")?g(a,c+"."+o,!0):beacon.utility.isType(b[o],"Object")&&beacon.on("updateObjectData",{currentScopeIndex:d,dataPath:c+"."+o}))}j||beacon.utility.merge(b,i)}else if(m){if(l=h,(b=b||[]).unshift=function(a){var b=[].concat(a,this);return l.set([]),l.set([].concat(b)),b},!j){var q=b.length,r=i.length;if(0===i.length)b.splice(0);else for(var o in b){var s=parseInt(o,10);beacon.utility.isType(s,"Number")&&!isNaN(s)||i[o]||(i[o]=void 0)}r<q&&b.splice(r-q,q-r),e=r,beacon.utility.merge(b,i)}for(var t=a.updateUI(),u=0;u<t.length;u++){var v=t[u];v&&f(v,d,d)}}else b=i}};return h}var i=e.scope,j=0,k=function(a){if(a.placeholder)return a.placeholder;var b=document.createComment("repeat placeholder "+a.getAttribute("b-repeat"));return a.parentNode.insertBefore(b,a),a.placeholder=b}(b),l=b.getAttribute("b-repeat").match(/(\S+)\s+in\s+(\S+)/)||[],m=l[2],n=l[1],o=b.outerHTML,p=b.parentNode,q=(b.innerHTML,p.tagName.toLowerCase());p.removeChild(b);var r=function(b){for(var c="",d=document.createDocumentFragment(),e=[],f=0;f<b;f++){var g=j+f;c=a(o,g,m,n);var h=document.createElement(q);h.innerHTML=c;var i=h.firstChild;i.removeAttribute("b-repeat"),i.$index=g,d.appendChild(i),e.push(i)}var l,p,r="select"===q,s=k.parentNode;return r&&(l=s.initValue),s.insertBefore(d,k),r&&setTimeout(function(){s.value=l},0),p=k,"option"==i.nodeName.toLowerCase()&&setTimeout(function(){p.parentNode.value=p.parentNode.initValue},0),h=d=null,j+=b,e},s=function(a){for(var b=a.previousSibling;b&&1!==b.nodeType;)b=b.previousSibling;return b},t=[],u={updateUI:function(a){var b,d=(b=a,((c.getData(b||m,i)||[]).length||0)-j),e=0<d;return d<0&&function(a){a=Math.abs(a);for(var b=0;b<a;b++){var c=s(k);c&&k.parentNode.removeChild(c)}j-=a}(d),e&&r(d)},getDataPrefix:function(){return n}};return g(u,m,!0),u}}),Air.Module("B.scope.tagManager",function(require){function addNode(a,b,c,d){nodeMap[a]=nodeMap[a]||{},nodeMap[a][b]=nodeMap[a][b]||[],nodeMap[a][b].push({element:c,template:c.$template,callback:d})}function getNodes(a,b){var c=nodeMap[a];return c&&c[b]||[]}function updateNodeValue(scopeIndex,scope,token,callback){for(var nodes=getNodes(scopeIndex,token),_loop_1=function(i){var activeNode=nodes[i],newValue=activeNode.element.$template.replace(/{{(.*?)}}/g,function(tag,expression){return eval(expression)||""}),ownerElement=activeNode.element.ownerElement;ownerElement&&"option"===ownerElement.nodeName.toLowerCase()&&ownerElement.parentNode&&setTimeout(function(){ownerElement.parentNode&&(ownerElement.parentNode.value=ownerElement.parentNode.initValue)},0),activeNode.element.nodeValue=newValue,activeNode.callback&&activeNode.callback(newValue)},i=0;i<nodes.length;i++)_loop_1(i)}var util=require("B.util.util"),nodeMap=[],api={addNode:addNode,getNodes:getNodes,updateNodeValue:updateNodeValue};return api}),Air.Module("B.scope.scopeManager",function(require){function isView(a){return util.isHTML(a)&&"VIEW"==a.nodeName.toUpperCase()}function isRepeat(a){return util.isHTML(a)&&a.hasAttribute("b-repeat")}function bindObjectData(a,b,c){for(var d=(scopeTreeManager.getScope(b)||scopeTreeManager.getRoot()).scope,e="",f=a.split(".")||[],g=0;g<f.length;g++){var h=f[g],i=e?util.getData(e,d):d;i=i||Air.NS(e,d);var j=h&&util.getData(h,i);h&&(!Object.getOwnPropertyDescriptor(i,h)||!Object.getOwnPropertyDescriptor(i,h).set||/^\d+$/.test(h)||g===f.length-1)&&Object.defineProperty(i,h,createDescriptor.call(i,j,a,b,c)),e=h&&e?e+"."+h:h}}function getTokens(a,b,c){b.$template=b.$template||b.nodeValue,scopeTreeManager.getScope(c);for(var d=a.match(/(['"])\s*([$a-zA-Z\._0-9\s\-]+)\s*\1|(['"])?\s*([$a-zA-Z\._0-9\s]+)\s*\1?/g)||[],e=[],f=0;f<d.length;f++)!function(c){var f=util.trim(d[c]);if(!/^\d+$/.test(f)&&!/^['"]/.test(f)&&""!=f&&"true"!==f&&"false"!==f){var g=new RegExp("(^|\\b).*?("+f.replace(/([.*?+\-^\/$])/g,"\\$1")+")","g"),h=b.$tag||a,i=h.replace(g,function(a,b,c){return 0<=a.indexOf('util.getData("'+f)?a:a.replace(c,'util.getData("'+f+'", scope)')});b.$template=b.$template.replace(h,i),b.$tag=i,e.push(f)}}(f);return 0===e.length&&(b.$tag=a),e}function tryGenerateSubViewScope(a,c){if("view"===a.tagName.toLowerCase()){var d=a.getAttribute("b-scope-key"),e=a.getAttribute("name"),f=d||e,g=c.scope,h=c.name;if(!g){var i=scopeTreeManager.addScope(h,f);g=scopeTreeManager.getScope(i)}if(d){var j=(memCache.get("controllerMap")||{})[e];j&&setTimeout(function(){b.run(e,j)},0)}}return c}function createDescriptor(a,b,c,d){var e=scopeTreeManager.getScope(c),f=0;return{enumerable:!0,configurable:!0,get:function(){return beacon.utility.isType(a,"Array")&&setTimeout(function(){f!==a.length&&d&&d(),f=a.length},0),a},set:function(f){var g=a!==f,h=beacon.utility.isType(f,"Array"),i=beacon.utility.isType(f,"Object");if(g&&(h||i)){if(a=a||(h?[]:{}),h){var j=a.length,k=f.length;k<j&&a.splice(k-j,j-k)}if(i)for(var l in a)l in f||(f[l]=void 0);beacon.utility.merge(a,f),h&&d&&d()}else a!==f&&(a=f,tagManager.updateNodeValue(c,e.scope,b))}}}var rootScope={},ScopeTreeManager=require("B.scope.ScopeTreeManager"),initModel=require("B.directive.model"),eventDirective=require("B.directive.event"),showDirective=require("B.directive.show"),existDirective=require("B.directive.exist"),styleDirective=require("B.directive.style"),propertyDirective=require("B.directive.property"),Repeater=require("B.directive.Repeater"),tagManager=require("B.scope.tagManager"),util=require("B.util.util"),nodeUtil=require("B.util.node"),memCache=require("B.data.memCache"),scopeTreeManager=new ScopeTreeManager,backtrackingPoints=[];beacon.on("updateObjectData",function(a,b){bindObjectData(b.dataPath,b.currentScopeIndex)});var ScopeManager=function(){function ScopeManager(){this.getScope=function(a){return scopeTreeManager.getScopeByName(a)},this.setRoot=function(a){return scopeTreeManager.setRootScope(a)},this.getScopeInstance=function(a){return scopeTreeManager.getScopeInstanceByName(a)}}return ScopeManager.prototype.parseScope=function(a,b,c){var d=scopeTreeManager.getScopeByName(a);return d||(this.parseTemplate(b,a),d=scopeTreeManager.getScopeByName(a)||{}),d.scope},ScopeManager.prototype.watchData=function(a,b,c,d,e){for(var f=scopeTreeManager.getScope(c),g=getTokens(a,b,c),h=0;h<g.length;h++){var i=g[h];d&&e&&d(util.getData(i,f.scope)),tagManager.addNode(c,i,b,d),bindObjectData(i,c,d)}},ScopeManager.prototype.parseTEXT=function(node,currentScopeIndex){for(var tags=node.nodeValue.match(/{{.*?}}/g)||[],scopeStructure=scopeTreeManager.getScope(currentScopeIndex)||scopeTreeManager.getRoot(),scope=scopeStructure.scope,i=0;i<tags.length;i++){var activeTag=tags[i];if(this.watchData(activeTag,node,currentScopeIndex),node.$tag){var val=eval(node.$tag.replace(/(^{{)|(}}$)/g,""))||"";node.nodeValue=node.nodeValue.replace(activeTag,val),node.$tag=""}}},ScopeManager.prototype.parseHTML=function(a,b){var c=scopeTreeManager.getScope(b)||scopeTreeManager.getRoot();tryGenerateSubViewScope(a,c);var d=c.scope;if(existDirective(a,c,this.watchData),a.parentElement){initModel(a,c,this.watchData),eventDirective(a,d),showDirective(a,c,this.watchData),styleDirective(a,c,this.watchData),
propertyDirective(a,c,this.watchData);for(var e=[].concat.apply([],a.attributes),f=0;f<e.length;f++){var g=e[f];-1===[initModel.key,showDirective.key].indexOf(g.name)&&this.parseTEXT(g,b)}}},ScopeManager.prototype.parseViewElement=function(a){return a.lastChild},ScopeManager.prototype.parseTemplate=function(a,b){void 0===b&&(b="root");for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];var e=document.createNodeIterator(a,NodeFilter.SHOW_ALL),f=[],g=[],h=a;do{if(isView(h)){f.push(b);var i=h.lastChild;i&&g.push(i),b=h.getAttribute("b-scope-key")||h.getAttribute("name");var j=f[f.length-2];scopeTreeManager.addScope(j,b)}else if(isRepeat(h)){h.nextSibling;var k=this.createRepeatNodes(h,b);if(k)for(var l=0;l<k.length;l++){var m=k[l];this.parseTemplate(m,b)}}switch(h.nodeType){case nodeUtil.type.HTML:this.parseHTML(h,b);break;case nodeUtil.type.TEXT:case nodeUtil.type.ATTR:this.parseTEXT(h,b)}g[g.length-1]===h&&(g.pop(),b=f.pop())}while(h=e.nextNode())},ScopeManager.prototype.createRepeatNodes=function(a,b){var c=this,d=scopeTreeManager.getScope(b);return new Repeater(a,b,d,function(a,b,d,e,f){c.parseTemplate(a,b,d,e,f)}).updateUI()},ScopeManager}();return new ScopeManager}),Air.Module("B.network.HTTP",function(){function a(){var a=new XMLHttpRequest,c=this;a.onreadystatechange=function(){a.readyState===b&&(200<=a.status&&a.status<300||304==a.status||0==a.status&&c.requestURL.match(/^file:/)?c.successCallBack&&c.successCallBack(a):c.errorCallBack&&c.errorCallBack(a))},this.xhr=a}var b=4;return a.prototype={request:function(a){for(var b in this.requestURL=a.url,this.successCallBack=a.successCallBack,this.errorCallBack=a.errorCallBack,this.xhr.open(a.method,a.url,!0),a.header)this.xhr.setRequestHeader(b,a.header[b]);this.xhr.send(a.data)},get:function(a,b){b=b||{},this.request({method:"GET",url:a,successCallBack:b.successCallBack,errorCallBack:b.errorCallBack})},abort:function(){this.xhr.abort()}},a}),Air.Module("B.service.Request",function(require){var a=require("B.network.HTTP"),b=require("B.event.events"),c=require("B.data.storage"),d=require("B.util.middleware");return function(){function e(b,c,d){void 0===c&&(c={}),this.http=new a,this.options={},this.EVENTS={SUCCESS:beacon.createEvent("service response success"),TIMEOUT:beacon.createEvent("service request timout"),ERROR:beacon.createEvent("service response error"),BIZERROR:beacon.createEvent("business error"),NETWORKERROR:beacon.createEvent("network error")},this.request=b,this.options=c,this.scope=d}return e.callBeforeQueryMiddleware=function(a,b){d.run("beforeQuery",a,b)},e.callAfterQueryMiddleware=function(a,b){d.run("afterQuery",a,b)},e.prototype.sendRequest=function(a){var b=this;void 0===a&&(a=this.request),e.callBeforeQueryMiddleware(a,function(){a.successCallBack=function(a){b.httpSuccessCallback(a)},a.errorCallBack=function(a){b.httpErrorCallback(a)},b.http.request(a),b.startTimeoutCount()})},e.prototype.startTimeoutCount=function(){var a=this;this.timer=setTimeout(function(){a.http.abort()},1e3*this.options.timeout)},e.prototype.clearTimeoutCount=function(){clearTimeout(this.timer)},e.prototype.parseResponseError=function(a){var c=this,d={xhr:this.http.xhr,data:a,requestParam:this.request,errorCode:e.ERROR_CODE.parse};e.callAfterQueryMiddleware(d,function(a){c.options.errorCallBack&&c.options.errorCallBack(e.ERROR_CODE.parse),beacon(c).on(c.EVENTS.ERROR,{error:e.ERROR_CODE.parse,errorType:"response parse error"}),beacon(c.scope).on(b.DATA_CHANGE)})},e.prototype.cacheResponse=function(a){this.options.expiredSecond&&c.set(this.options.cacheKey,a,{expiredSecond:this.options.expiredSecond})},e.prototype.responseComplate=function(a,c){var d=this,f={xhr:this.http.xhr,data:a,requestParam:this.request};e.callAfterQueryMiddleware(f,function(f){if(f){d.options.errorCallBack&&d.options.errorCallBack(e.ERROR_CODE.business,a);var g={error:e.ERROR_CODE.business,errorType:"business error",response:a};return beacon(d).on(d.EVENTS.ERROR,g),void beacon(d).on(d.EVENTS.BIZERROR,g)}d.cacheResponse(c),d.options.successCallBack&&d.options.successCallBack(a),beacon(d).on(d.EVENTS.SUCCESS,a),beacon(d.scope).on(b.DATA_CHANGE)})},e.prototype.httpSuccessCallback=function(a){void 0===a&&(a={}),this.clearTimeoutCount();var b,c="";if(4===a.readyState){c=a.responseText;try{b=JSON.parse(c),this.responseComplate(b,c)}catch(a){return void this.parseResponseError(b)}}},e.prototype.httpErrorCallback=function(a){var c=this;this.clearTimeoutCount();var d=a.status?e.ERROR_CODE.network:e.ERROR_CODE.timeout,f=(a.status,{errorCode:d,xhr:a,requestParam:this.options});e.callAfterQueryMiddleware(f,function(a){c.options.errorCallBack&&c.options.errorCallBack(d,a),beacon(c).on(c.EVENTS.ERROR,{error:d,response:a})}),beacon(this.scope).on(b.DATA_CHANGE)},e.ERROR_CODE={parse:1,timeout:2,network:3,business:4},e}()}),Air.Module("B.service.Service",function(require){require("B.network.HTTP");var a=require("B.data.storage"),b=require("B.service.Request");return function(){function c(a,b){void 0===a&&(a={}),this.requestQueue=[],this.EVENTS={SUCCESS:beacon.createEvent("service response success"),TIMEOUT:beacon.createEvent("service request timout"),ERROR:beacon.createEvent("service response error"),BIZERROR:beacon.createEvent("business error"),NETWORKERROR:beacon.createEvent("network error")},this.config=a,this.scope=b,this.config.header=this.config.header||{},this.config.header["Content-Type"]=this.config.header["Content-Type"]||"application/json;charset=utf-8"}return c.prototype.on=function(a,b){beacon(this).on(a,b)},c.prototype.off=function(a,b){beacon(this).off(a,b)},c.prototype.getConfig=function(){return this.config},c.prototype.responseCacheData=function(a,b){if(a)return b.successCallBack&&b.successCallBack(a,!0),void beacon(this).on(this.EVENTS.SUCCESS,a)},c.prototype.getCacheData=function(b){var c,d=this.config.protocol+"://"+this.config.host+this.config.path+JSON.stringify(b),e=a.get(d);try{c=JSON.parse(e)}catch(b){}return c},c.prototype.query=function(a,c){void 0===c&&(c={});var d=this.config.protocol+"://"+this.config.host+this.config.path,e=d+JSON.stringify(a),f=this.getCacheData(a);if(!c.noCache&&f)this.responseCacheData(f,c);else{var g={url:d,method:this.config.method,header:this.config.header,data:JSON.stringify(a),serviceName:this.config.serviceName};c.timeout=c.timeout||this.config.timeout,c.expiredSecond=c.expiredSecond||this.config.expiredSecond,c.cacheKey=e;var h=new b(g,c,this.scope);this.bindRequestEvent(h),this.requestQueue.push(h),h.sendRequest()}},c.prototype.bindRequestEvent=function(a){var b=this;beacon(a).on(a.EVENTS.SUCCESS,function(a,c){beacon(b).on(b.EVENTS.SUCCESS,c)}),beacon(a).on(a.EVENTS.TIMEOUT,function(a,c){beacon(b).on(b.EVENTS.TIMEOUT,c)}),beacon(a).on(a.EVENTS.BIZERROR,function(a,c){beacon(b).on(b.EVENTS.BIZERROR,c)}),beacon(a).on(a.EVENTS.NETWORKERROR,function(a,c){beacon(b).on(b.EVENTS.NETWORKERROR,c)}),beacon(a).on(a.EVENTS.ERROR,function(a,c){beacon(b).on(b.EVENTS.ERROR,c)})},c.prototype.abort=function(a){for(var b=0;b<this.requestQueue.length;b++)this.requestQueue[b].abort()},c.serviceQueue={},c}()}),Air.Module("B.service.serviceFactory",function(require){var a=require("B.service.Service"),b=require("B.util.middleware");return new(function(){function c(){this.configList=[],this.serviceList=[]}return c.prototype.getConfig=function(a){return this.configList[a]||{}},c.prototype.addMiddleware=function(a,c){b.add(a,c)},c.prototype.removeMiddleware=function(a,c){b.remove(a,c)},c.prototype.setConfig=function(a,b){a&&(this.configList[a]=b)},c.prototype.set=function(a,b){if(!a)throw new Error("serviceName is required");var c=beacon.utility.merge({},this.getConfig(b.extend),b);this.serviceList[a]=c},c.prototype.get=function(b,c){var d=this.serviceList[b];if(d)return d.serviceName=b,new a(d,c);throw new Error(b+" not found")},c.prototype.abortAll=function(){for(var a in this.serviceList)this.serviceList.hasOwnProperty(a)&&this.serviceList[a].abort(!0)},c}())}),Air.Module("B.router.router",function(){return new(function(){function a(){this.routers=[]}return a.getURLByRule=function(a,b,c,d){var e,f=a.replace(/:(\w+)/gi,function(a,c){return b[c]||""});return location.origin||(e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")),f=(d?"":location.origin||e)+f+c},a.tryMatchParams=function(a,b){var c,d=b.match(a.reg);if(d){c={rule:a.rule,viewName:a.viewName,params:{}};for(var e=d.length,f=1;f<e;f++){var g=a.params[f-1];c.params[g]=d[f]}}return c},a.parseRule=function(a){var b=[],c=a.replace(/:[\w-]+/gi,function(a){return b.push(a.replace(":","")),"([\\w-]+)"});return{reg:new RegExp("^"+c+"/*$","i"),params:b}},a.prototype.set=function(b){var c=a.parseRule(b.rule),d={rule:b.rule,viewName:b.viewName,sign:b.sign,reg:c.reg,params:c.params};this.routers.push(d),this.routers[b.viewName]=d},a.prototype.getMatchedRouter=function(b){for(var c=this.routers.length,d=0;d<c;d++){var e=this.routers[d],f=a.tryMatchParams(e,b);if(f)return f}return null},a.prototype.getURLPathByViewName=function(b,c){var d=(c=c||{}).params||{},e=c.query||"";e=c.hash?e+c.hash:e;var f=this.routers[b],g=f&&f.rule||"";return a.getURLByRule(g,d,e,c.noOrigin)},a.prototype.get=function(a){return this.routers[a]||{}},a}())}),Air.Module("B.view.View",function(require){var a=require("B.scope.scopeManager");return require("B.event.events"),function(){function b(a,c,d){if(void 0===d&&(d={}),this.initQueue=[],this.showBeforeQueue=[],this.showAfterQueue=[],this.hideQueue=[],this.events={onShow:beacon.createEvent("view onShow"),onHide:beacon.createEvent("view onHide")},this.show=function(){this.dom.setAttribute("active","true")},this.hide=function(){this.dom.removeAttribute("active")},this.getDom=function(){return this.dom},this.viewName=a,beacon.isType(c,"String")){var e=b.createDomByString(c);this.dom=e.querySelector('view[name="'+a+'"]'),b.parseTag("style",a,e,function(a){b.loadStyle(a,c)}),b.parseTag("script",a,e,function(a){b.loadScript(a,c,d.initCallback)})}else this.dom=c}return b.createDomByString=function(a){var b=document.createElement("div");return"undefined"==typeof DOMParser?b.innerHTML="X<div></div>"+a:b.innerHTML=a,b},b.loadStyle=function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];b.appendChild(e)}},b.loadScript=function(a,c,d){setTimeout(function(){b.runJS(a,c)},0),d&&d()},b.runJS=function(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=document.createElement("script"),f=d.src;d.parentNode&&d.parentNode.removeChild(d),f?Air.loadJS(f):(e.text=d.text,b.appendChild(e))}},b.splitDom=function(a,b){var c=a.getElementsByTagName(b);return c=[].concat.apply([],c)},b.parseTag=function(c,d,e,f){var g=b.splitDom(e,c);g=[].concat.apply([],g);for(var h=0;h<g.length;h++)a.parseScope(d+c,g[h],!0),f&&f(g)},b.prototype.getViewName=function(){return this.viewName},b.prototype.parseSrc=function(){var a=this.dom.querySelectorAll("[b-src]");if(a)for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.getAttribute("b-src");e&&d.setAttribute("src",e)}},b}()}),Air.Module("B.view.viewManager",function(require){var a=require("B.view.View"),b=require("B.router.router"),c=require("B.network.HTTP"),d=require("B.data.memCache"),e=require("B.scope.scopeManager"),f=require("B.event.events"),g=require("B.util.middleware"),h={loadingHandle:null,showLoading:function(){h.loadingHandle&&h.loadingHandle.show()},hideLoading:function(){h.loadingHandle&&h.loadingHandle.hide()},setLoading:function(a){h.loadingHandle=a},unsetLoading:function(){h.loadingHandle=null}};return new(function(){function i(){this.loading=h,this.loadingViewList=[]}return i.prototype.setMainViewport=function(a){this.mainViewport=a},i.prototype.initLocalView=function(b){for(var c=b.dom.children,d=c.length,f=0;f<d;f++){var g=c[f];if("view"===g.tagName.toLowerCase()){var h=g.getAttribute("name"),i=new a(h,g);b.views[h]=i,e.parseScope(h,i.getDom())}}},i.prototype.getViewByViewName=function(a){return this.mainViewport.views[a]},i.prototype.appendView=function(a,b){this.mainViewport.dom.appendChild(b.getDom()),this.mainViewport.views[a]=b},i.prototype.changeURLParams=function(a,b){if(void 0===b&&(b={}),!b.isComponent){var c=e.getScopeInstance(a);c.$request=c.$request||{},c.$request.params=b.params}},i.prototype.getURL=function(a,c){return b.getURLPathByViewName(a,{params:c.params,query:c.query,hash:c.hash})},i.prototype.switchURL=function(a,b){if(void 0===b&&(b={}),!b.isComponent){var c=this.getURL(a,b),d=b.replace;if(history.pushState&&history.replaceState){var e=d?history.replaceState:history.pushState;e&&e.call(history,{viewName:a,params:b.params,hash:b.hash},a,c)}else d?!b.init&&location.replace(c):location.href=c;this.runURLChangeMiddleWare()}},i.prototype.runURLChangeMiddleWare=function(){g.run("afterURLChange")},i.prototype.listenURLChange=function(){var a=this;beacon(window).on("popstate",function(c){var d=c.state||{};if(a.saveLastView(),d.viewName)if(a.getViewByViewName(d.viewName))a.changeURLParams(d.viewName,d),a.show(d.viewName),a.runURLChangeMiddleWare();else{var e=location.pathname,f=b.getMatchedRouter(e);f?a.goTo(f.viewName,{replace:!0,params:f.params,query:location.search,hash:location.hash}):a.throw404()}})},i.prototype.show=function(a){var b=this.getViewByViewName(a);b?(b.parseSrc(),this.switchView(b)):this.throw404()},i.prototype.throw404=function(){g.run("viewNotFound")},i.prototype.saveLastView=function(){this.lastView=this.getActive()},i.prototype.setActive=function(a){this.activeView=a},i.prototype.switchView=function(a){var b="";this.lastView&&(b=this.lastView.getViewName(),this.triggerOnHide(this.lastView,a)),this.setActive(a),this.activeView.show(),this.triggerOnShow(this.activeView,b),h.hideLoading()},i.prototype.triggerOnHide=function(a,b){var c=a.getViewName();a&&a.hide(),beacon(a).on(a.events.onHide,{to:b});var d=e.getScopeInstance(c);beacon(d).on(f.DATA_CHANGE)},i.prototype.triggerOnShow=function(a,b){var c=a.getViewName();c!==b&&beacon(a).on(a.events.onShow,{from:b});var d=e.getScopeInstance(c);beacon(d).on(f.DATA_CHANGE)},i.prototype.initLocalViewport=function(){for(var a=[],b=document.querySelectorAll("viewport"),c=b.length,d=0;d<c;d++){var e=b[d],f="true"===e.getAttribute("main"),g={dom:e,views:{}};a.push(g),f&&this.setMainViewport(g),this.initLocalView(g)}},i.prototype.loadView=function(g,i){var j=this;void 0===i&&(i={}),h.showLoading();var k=d.get("env"),l=b.get(g).sign||"",m=l?"_"+l:"",n=(i.templatePath||k.$templatePath)+g+m+".html";(new c).get(n,{successCallBack:function(b){var c=b.responseText,d=new a(g,c,{initCallback:function(){}}),h=e.parseScope(g,d.getDom());j.changeURLParams(g,i),j.appendView(g,d),j.saveLastView(),j.setActive(d),beacon(h).once(f.RUN_COMPLETE,function(){j.switchURL(g,i),j.show(g),j.removeLoadingView(g)})},errorCallBack:function(){j.throw404()}})},i.prototype.viewIsLoading=function(a){return!this.loadingViewList.indexOf(a)},i.prototype.addLoadingView=function(a){-1===beacon.utility.arrayIndexOf(this.loadingViewList,a)&&this.loadingViewList.push(a)},i.prototype.removeLoadingView=function(a){var b=beacon.utility.arrayIndexOf(this.loadingViewList,a);-1!==b&&this.loadingViewList.splice(b,1)},i.prototype.goTo=function(a,b){var c=this,d={viewName:a,options:b};g.run("beforeGoTo",d,function(){var d=c.getViewByViewName(a);c.viewIsLoading(a)||(d?(c.saveLastView(),c.switchURL(a,b),c.changeURLParams(a,b),c.show(a)):(c.addLoadingView(a),c.loadView(a,b)))})},i.prototype.jump=function(a){var b=a.url||"",c=a.project||"",d=a.urlPath||"",e=a.query||"";c=c.replace(/^\//,"");var f=new RegExp("^(/)?("+c+"[/|$])?");d=d.replace(f,""),location.href=b||"/"+(c||"")+"/"+(d||"")+(e||"")},i.prototype.back=function(){window.history.back()},i.prototype.addMiddleware=function(a,b){g.add(a,b)},i.prototype.removeMiddleware=function(a,b){g.remove(a,b)},i.prototype.getActive=function(){return this.activeView},i.prototype.getScopeKeyByViewName=function(a){var b=this.activeView.getDom().querySelector('view[name="'+a+'"]');return b&&b.getAttribute("b-scope-key")||""},i.prototype.getTemplate=function(a,b){void 0===b&&(b={});var e=d.get("env"),f=(b.path||e.$templatePath)+b.templatePath.replace(/\./g,"/")+".html",g=b.errorCallBack||function(){},h=this.templateCache[a];if(h)return h;(new c).get(f,{successCallBack:function(c){var d=c.responseText;this.templateCache[a]=d,b.onSuccess&&b.onSuccess(d)},errorCallBack:g})},i.prototype.init=function(a){e.setRoot(a),this.initLocalViewport();var c=location.pathname,d=b.getMatchedRouter(c),f=location.hash;d?this.goTo(d.viewName,{replace:!0,init:!0,params:d.params,query:location.search,hash:f}):this.throw404(),this.listenURLChange()},i}())}),Air.Module("B.controller.run",function(require){var a=require("B.data.memCache");return function(b,c){var d=require("B.scope.scopeManager"),e=require("B.view.viewManager"),f=require("B.event.EVENTS"),g=e.getScopeKeyByViewName(b),h=d.getScopeInstance(g||b);if(g){var i=a.get("controllerMap");i||(i={},a.set("controllerMap",i)),i[b]=c,a.set("controllerMap",i)}Air.run(c,!1,h),Air.run(function(){beacon(h).on(f.DATA_CHANGE,h),beacon(h).on(f.RUN_COMPLETE)})}}),Air.Module("B.TDK.TDK",function(){function a(a){var c,d,e=b.querySelector("meta[name="+a+"]");return e=e||(c=a,(d=document.createElement("meta")).setAttribute("name",c),b.appendChild(d),d)}var b=document.head||document.getElementsByTagName("head")[0];return{setTitle:function(a){return document.title=a||document.title,document.title},setDescription:function(b){var c=a("description");return c.content=b||c.content,c.content},setKeywords:function(b){var c=a("keywords");return c.content=b||c.content,c.content}}}),Air.run(function(require){var a=require("B.view.viewManager"),b=require("B.scope.scopeManager"),c=require("B.router.router"),d=require("B.data.memCache"),e=require("B.controller.run"),f=require("B.service.serviceFactory"),g=require("B.network.HTTP"),h=require("B.data.storage"),i=require("B.TDK.TDK"),j=function(){function j(){this.FRAMEWORK_NAME="b",this.views=a,this.router=c,this.scopeManager=b,this.service=f,this.run=e,this.Module=Air.Module,this.TDK=i,this.bridge={run:function(){},isHybrid:!1,isInApp:!1},this.utility={storage:h,HTTP:g}}return j.prototype.init=function(b){void 0===b&&(b={}),d.set("env",b),Air.moduleURL(b.$moduleURL),a.init(b)},j.prototype.ready=function(a){void 0===a&&(a=function(){}),Air.domReady(function(){a()})},j.prototype.setModuleURL=function(a){Air.moduleURL(a)},j}();window.b=new j});